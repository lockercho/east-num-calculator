<!DOCTYPE html>
<html>

<head>
    <title>東方靈數（好命密碼）計算機</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3Y8XCL2WW1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-3Y8XCL2WW1');
    </script>
    <!-- bing search -->
    <meta name="msvalidate.01" content="15E08000B1A2EA68A630CF560DE6CC19" />
    <!-- adsense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3577336627928306"
        crossorigin="anonymous"></script>
    <meta name="description" content="探索東方靈數的神秘世界，使用靈數計算機深入了解您的生命數字和運勢，引導您走向更豐盛的人生。神仙補習班腦粉謹製。(東方靈數 / 好命密碼 / 數字易經)">
</head>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
<style>
    p,
    div,
    input,
    button {
        font-size: 20px;
    }

    body {
        background-color: #fffaf0;
    }

    table,
    th,
    td {
        border: 1px solid black;

    }

    th,
    td {
        padding: 2px 20px;
    }

    .hide {
        display: none;
    }

    .striked {
        text-decoration: line-through;
    }

    .free-input-label {
        padding: 5px 10px;
        font-size: 20px;
    }

    button {
        margin: 0 10px 0 0;
    }

    .gray {
        color: gray;
        font-style: italic;
    }

    .callout {
        --bs-link-color-rgb: var(--bd-callout-link);
        --bs-code-color: var(--bd-callout-code-color);
        padding: 1.25rem;
        margin-top: 1.25rem;
        margin-bottom: 1.25rem;
        color: var(--bd-callout-color, inherit);
        background-color: var(--bd-callout-bg, var(--bs-gray-100));
        border-left: 0.25rem solid var(--bd-callout-border, var(--bs-gray-300));
    }

    .btn-light {
        margin: 10px 0;
        border: 1px solid hsl(0deg, 0%, 86%)
    }

    .btn {
        margin-right: 10px;
    }

    h1 {
        padding-top: 20px;
    }

    input {
        vertical-align: middle;
    }

    header {
        margin-bottom: 20px;
    }

    #result-free-stats {
        margin-bottom: 40px;
    }
</style>

<body class="container">
    <header>
        <h1>東方靈數計算器</h1>
    </header>
    <div class="card">
        <div class="card-body">
            <h3 style="color: blue">嚴正聲明：</h3>
            <h4>本網站所有功能為「免費」使用，也僅提供「非營利」使用。</h4>
            <h4>知識來源為「神仙補習班」介紹的「東方靈數」。</h4>
            <h4>我們沒有跟任何單位合作收費，也沒有開設任何 Line 群 / IG / Facebook 群組，請慎防詐騙。</h4>
        </div>
    </div>
    <div><br>計算所輸入數字的東方靈數<br>（生氣、天醫、延年、伏位、絕命、五鬼、六煞、禍害）</div>
    <p><br>數字意義解說請看：<a target="_blank"
            href="https://docs.google.com/spreadsheets/u/0/d/18McHGqDtBXo3KZub1rwe8vI3SGXFI7lctMWY9U6yl4c/htmlview">東方靈數
            分享版 </a></p>
    <!-- Section 1 -->
    <div class="card">
        <div class="card-body">
            <h2 class="card-title">分析1：人格類型+人生大運</h2>
            <p for="numberInput">請輸入身分證字號：</p>
            <input autofocus type="text" id="numberInput" onkeydown="if(event.keyCode == 13){calculateID()}"
                style="font-size: 20px;">
            <button class="btn btn-light" onclick="calculateID()">計算</button>

            <p id="recap-input"></p>
            <p id="result-overall-type"></p>
            <p id="result-yearly-fortune"></p>
        </div>
    </div>
    <hr />
    <!-- Section 2 -->
    <div class="card">
        <div class="card-body">
            <h2 class="card-title">分析2：一組數字（手機、車牌、住址等）</h2>
            <p>
                若遇到英文，會依照A=01, B=02, ... 的規則轉換
                <br />非英文或數字的符號會被跳過
            </p>

            <p>地址也可，但數字請使用半型阿拉伯數字，例如 100台北市中正區重慶南路1段122號</p>
            <h4 for="numberInputAny">請輸入一串英數字：</h4>
            <input type="text" id="numberInputAny" onkeydown="if(event.keyCode == 13){calculateAny()}"
                style="font-size: 20px;">
            <button class="btn btn-light" onclick="calculateAny()">計算</button>
            <p id="recap-input-2"></p>
            <p id="result-any"></p>
            <p id="result-any-stats"></p>
        </div>
    </div>
    <hr />
    <!-- Section 3 -->
    <div class="card" id="section-3">
        <div class="card-body">
            <h2 class="card-title">分析3：多組數字</h2>
            <p>
                身分證字號 / 手機 / 車牌 / 住址 / 其他數字等多組一起計算。<br>
                看相互抵銷後最後是哪些靈數。
            </p>
            <div class="free-input">
                <input type="text" id="free-input" onkeydown="if(event.keyCode == 13){transformInputToLabel()}"
                    style="font-size: 20px;">
                <button class="btn btn-light" onclick="transformInputToLabel()">新增</button>
            </div>
            <div id="free-input-labels">
            </div>
            <p id="recap-free-input"></p>
            <p id="result-free-stats"></p>
            <p id="result-free"></p>

        </div>
    </div>
    <hr />
    <!-- Other notes -->
    <div class="card" id="tips">
        <div class="card-body">
            <h2>數字化解口訣</h2>
            <p>建議由粗體字開始使用</p>
            <p>
                <u>天醫</u> 欺 <u>絕命</u>：看到自己有絕命，請用天醫化解 (<strong>13, 31, 68, 86</strong>, 49, 94, 72, 27)<br>
                <u>延年</u> 壓 <u>六煞</u>：看到自己有六煞，請用延年化解 (<strong>19, 91, 87, 78</strong>, 34, 43, 26, 62)<br>
                <u>生氣</u> 補 <u>禍害</u>：看到自己有禍害，請用生氣化解 (<strong>14, 41, 76, 67</strong>, 93, 39, 82, 28)<br>
                <u>生氣+天醫+延年</u> 化 <u>五鬼</u> (順序不可變)<br>
                <br>
                不確定數字補出了什麼可以用上面的 <strong>分析3</strong> 查詢
            </p>
        </div>
    </div>
    <hr />
    <p>
        參考資料:
    <ul>
        <li><a target="_blank"
                href="https://docs.google.com/spreadsheets/u/0/d/18McHGqDtBXo3KZub1rwe8vI3SGXFI7lctMWY9U6yl4c/htmlview">
                東方靈數解釋 分享版 （ \感謝社群/ ） </a></li>
        <li><a target="_blank" href="https://www.chinyuan.com.tw/all_book/more?id=4878"> 好命密碼 - 數字磁場的魅力 </a></li>
        <li><a target="_blank" href="https://www.youtube.com/watch?v=7__exuY_6Bg"> 神仙補習班 - 東方靈數 </a></li>
        <li> <a target="_blank" href="https://www.instagram.com/p/C2RWknTP7ce/"> 神仙補習班 ig </a></li>
    </ul>
    </p>
    <hr />
    <p>
        作者說明區 (2024/5/17 update):
    <ul>
        <li>網站不會搜集資料，請安心餵各種數字。</li>
        <li>近日有新聞踢爆有打著數字易經/東方靈數的詐騙群組。</li>
        <li>我也一度考慮是否關閉網站，不要成為詐騙集團的幫兇。</li>
        <li>但就像開頭說的，本網站幫助希望藉由東方靈數改善生活的人。如果就此關閉，是本末倒置、因噎廢食。</li>
        <li>身為一個相信開源會讓世界更美好的工程師，網站會繼續維持營運，也會一直免費。</li>
    </ul>
    <hr>
    <p style="display: none;">1413191</p>
    <p style="display: none;">$$$$$</p>
    <p>如果這個免費工具有幫助到你、你也支持開放世界、或單純想請我喝<span style="display: none;">1413191</span>杯咖啡，這邊開放隨喜抖內💰：<br>
        <table>
            <tbody>
                <tr>
                    <td>💰 Richart (812) 2888-10024-39067<br><br>
                    <img src="richart.PNG" width="250" alt=""/>
                    <p style="display: none;">1413191</p>
                    <p style="display: none;">$$$$$</p>
                    </td>
                    <td>
                        <br>
                        💰 Line bank (824) 111-0182-62978<br><br>
                    <img src="linebank.jpg" width="250" alt=""/>
                    <p style="display: none;">1413191</p>
                    <p style="display: none;">$$$$$</p>
                    </td>
                </tr>
            </tbody>
        </table>
        
        祝看到這裡的人好運旺旺，一切的安排都以最高最美好發生。<br>
    </p>
    <p style="display: none;">$$$$$</p>
    <p style="display: none;">1413191</p>
    </p>
    <input style="display: none;" id="hidden-input" />

</body>

</html>
<script>
    function convertToAlphabeticalOrder(letter) {
        var lowercaseLetter = letter.toLowerCase();
        var alphabeticalOrder = lowercaseLetter.charCodeAt(0) - 96;
        if (alphabeticalOrder > 26 || alphabeticalOrder < 1) {
            return null;
        }
        return alphabeticalOrder.toString().padStart(2, '0');
    }

    function skipNonHalfWidthNumbers(value) {
        var newValue = "";
        for (var i = 0; i < value.length; i++) {
            var code = value.charCodeAt(i);
            if (code >= 48 && code <= 57) {
                newValue += value.charAt(i);
            } else {
                var tmp = convertToAlphabeticalOrder(value.charAt(i))
                if (tmp != null) {
                    newValue += tmp;
                }
            }
        }
        return newValue
    }


    function parse05(value, keep5) {
        var v = value.split("");
        var newValue = "";
        for (var i = 0; i < v.length; i++) {
            if (v[i] == '5' && i > 0 && i < v.length - 1 && keep5 == false) {
                // skip middle 5
                continue
            }
            newValue += v[i];
        }
        return newValue;
    }

    function getIDInput() {
        return skipNonHalfWidthNumbers(document.getElementById("numberInput").value);
    }
    function getAnyInput() {
        return skipNonHalfWidthNumbers(document.getElementById("numberInputAny").value);
    }
    var explanation = '<div><br>類型說明:<br>';
    explanation += '<li>（1）由[伏位] 代換成的其他靈數，會顯示為灰色斜線</li>';
    explanation += '<li>（2）[伏位] 會延續前面的數字能量</li>';
    explanation += '<li>（3）[生氣] 也會放大前面數字能量</li>';
    explanation += '<li>（4）比例要視數字強弱程度下調</li ></div>';

    function calculateID() {
        var numberForOverall = getIDInput()
        var numberForYearly = getIDInput()

        var namesCount = {};

        // show overall type
        var overallNum = numberForOverall
        if (numberForOverall.slice(0, 1) == '0') {
            overallNum = numberForOverall.slice(1)
        }
        console.log("overallNum", overallNum)


        var resDom = document.getElementById("result-overall-type")
        var pairs = calculate(overallNum)
        console.log("pairs", pairs)
        if (pairs.length == 0) {
            resDom.innerHTML = "輸入太短，須為2碼以上英數字"
            return
        }
        var { numbersLine, namesLine, namesCount, totalNames, table, realSeq } = createViewFromPairs(pairs);
        resDom.innerHTML = '<h4>類型：</h4>'
        resDom.innerHTML += "使用：<u>" + overallNum + "</u> (此項不看開頭0) <br> ";
        var { result, stats } = calOverallType(namesCount, totalNames)
        resDom.innerHTML += numbersLine + '<br>' + namesLine + "<br>"
        resDom.innerHTML += stats + "<br><br>" + result
        resDom.innerHTML += explanation;

        // show yearly fortune
        var resDom = document.getElementById("result-yearly-fortune")
        var { numbersLine, namesLine, namesCount, totalNames, table, realSeq } = createViewFromPairs(calculate(numberForYearly));
        resDom.innerHTML = '<h4>人生大運：</h4>'
        resDom.innerHTML += "<div>"
        resDom.innerHTML += "大運使用：<u>" + numberForYearly + "</u><br>";
        resDom.innerHTML += numbersLine + '<br>' + namesLine + "<br>"
        resDom.innerHTML += "</div>"
        resDom.innerHTML += "<br>"
        resDom.innerHTML += table;
    }

    function calculateAny() {
        var number = getAnyInput()
        var inputNumber = "您輸入的數字為：<u>" + number + "</u>";

        var namesCount = {};

        var resDom = document.getElementById("recap-input-2")
        var pairs = calculate(number)
        if (pairs == false) {
            resDom.innerHTML = "輸入太短，須為2碼以上英數字"
            return
        }
        resDom.innerHTML = ''
        resDom.innerHTML += inputNumber

        var resDom = document.getElementById("result-any")
        var { numbersLine, namesLine, namesCount, totalNames, table, realSeq } = createViewFromPairs(pairs);
        resDom.innerHTML = numbersLine + '<br>' + namesLine + "<br>"

        var resDom = document.getElementById("result-any-stats")
        var { result, stats } = calOverallType(namesCount, totalNames)
        resDom.innerHTML = stats
    }

    var labelIDIncrement = 0;
    var hideIcon = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-slash-fill" viewBox="0 0 16 16"><path d="m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7 7 0 0 0 2.79-.588M5.21 3.088A7 7 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474z"/><path d="M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12z"/></svg>';
    var showIcon = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-fill" viewBox="0 0 16 16"><path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0"/><path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8m8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7"/></svg>';
    var copyIcon = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-copy" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z"/></svg>';
    function transformInputToLabel() {
        var newInput = document.getElementById("free-input").value
        var resDom = document.getElementById("recap-free-input")
        var pairs = calculate(newInput)
        if (pairs == false) {
            resDom.innerHTML = "輸入太短，須為2碼以上英數字"
            return false
        }
        // Add label
        var labelDom = document.getElementById("free-input-labels")
        var labelHTML = '<div id="free-div-' + labelIDIncrement + '">'
        labelHTML += '<span class="free-input-label" id="free-label-' + labelIDIncrement + '">'
        labelHTML += newInput
        labelHTML += '</span>'
        labelHTML += '<button class="btn btn-light" id="hide-button-' + labelIDIncrement + '" onclick="hideFree(' + labelIDIncrement + ')">' + hideIcon + ' 隱藏</button>'
        labelHTML += '<button class="btn btn-light hide" id="show-button-' + labelIDIncrement + '" onclick="showFree(' + labelIDIncrement + ')">' + showIcon + ' 顯示</button>'
        labelHTML += '<button class="btn btn-light" id="copy-button-' + labelIDIncrement + '" onclick="copyFree(' + labelIDIncrement + ')">' + copyIcon + ' 複製</button>'
        labelHTML += '<button class="btn btn-danger" onclick="deleteFree(' + labelIDIncrement + ')">刪除</button>'
        labelHTML += '</div>'
        labelIDIncrement++
        labelDom.innerHTML += labelHTML
        document.getElementById("free-input").value = ""
        calculateFree()
    }
    function hideFree(id) {
        // add strike to label
        // hide 'hide' button
        // show 'show' button
        document.getElementById("free-label-" + id).classList.add("striked")
        document.getElementById("hide-button-" + id).classList.add("hide")
        document.getElementById("show-button-" + id).classList.remove("hide")
        calculateFree()
    }
    function showFree(id) {
        // remove strike to label
        // show 'hide' button
        // hide 'show' button
        document.getElementById("free-label-" + id).classList.remove("striked")
        document.getElementById("hide-button-" + id).classList.remove("hide")
        document.getElementById("show-button-" + id).classList.add("hide")
        calculateFree()
    }
    function copyFree(id) {
        var str = document.getElementById("free-label-" + id).innerText;
        var input = document.getElementById("hidden-input");
        input.value = str;
        input.select();
        document.execCommand("copy");
        navigator.clipboard.writeText(str)
        // document.querySelector("#free-label-" + id).select()
        // document.execCommand("copy")
    }
    function deleteFree(id) {
        document.getElementById("free-div-" + id).remove()
        calculateFree()
    }

    function getFreeInputLabels() {
        var nodeList = document.querySelectorAll('.free-input-label')
        var res = []
        for (var i = 0; i < nodeList.length; i++) {
            if (!nodeList[i].classList.contains("striked")) {
                res.push(skipNonHalfWidthNumbers(nodeList[i].innerText))
            }
        }
        return res;
    }
    function payoffFiveGhost(sequence, payOffCount, allNamesCount) {
        for (var i = 0; i < sequence.length - 2; i++) {
            var n1 = sequence[i]
            var n2 = sequence[i + 1]
            var n3 = sequence[i + 2]
            if (payOffCount > 0 && n1 === '生氣' && n2 === '天醫' && n3 === '延年') {
                sequence[i] = '';
                sequence[i + 1] = '';
                sequence[i + 2] = '';
                allNamesCount[n1]--;
                allNamesCount[n2]--;
                allNamesCount[n3]--;
                payOffCount--;
            }
        }
        return {
            newSequence: sequence.filter(function (v) { return v !== '' }),
            payOffCount
        }
    }
    function payoffOthers(sequence, target, payOffCount, allNamesCount) {
        var mapping = {
            '絕命': '天醫', '六煞': '延年', '禍害': '生氣'
        }
        for (var i = 0; i < sequence.length; i++) {
            var n1 = sequence[i]
            if (payOffCount > 0 && n1 === mapping[target]) {
                sequence[i] = '';
                allNamesCount[n1]--;
                payOffCount--;
            }
        }
        return {
            newSequence: sequence.filter(function (v) { return v !== '' }),
            payOffCount
        }
    }
    function calculateFree() {
        var numbers = getFreeInputLabels() // Todo
        var allPairs = []
        var allPairsForPayoff = []
        var viewPairs = []
        var allNamesCount = {}
        var allTotalNames = 0
        console.log(numbers)
        var allNamesLine = ""

        for (var i = 0; i < numbers.length; i++) {
            pairs = calculate(numbers[i])
            allPairs = allPairs.concat(pairs)
            var { numbersLine, namesLine, namesCount, totalNames, table, realSeq } = createViewFromPairs(pairs);
            allPairsForPayoff.push(realSeq)
            allTotalNames += totalNames
            // merge dict
            for (var key in namesCount) {
                if (allNamesCount[key]) {
                    allNamesCount[key] += namesCount[key]
                } else {
                    allNamesCount[key] = namesCount[key]
                }
            }
            allNamesLine += numbersLine + '<br>' + namesLine + "<br>"
        }
        console.log("test allPairsForPayoff", allPairsForPayoff)
        console.log("allNamesCount", allNamesCount)

        // Payoff good and bad
        if (allNamesCount['五鬼'] > 0) {
            for (var i = 0; i < allPairsForPayoff.length; i++) {
                var sequence = allPairsForPayoff[i]
                var { newSequence, payOffCount } = payoffFiveGhost(sequence, allNamesCount['五鬼'], allNamesCount)
                console.log("payOffCount123", payOffCount)
                allPairsForPayoff[i] = newSequence
                allNamesCount['五鬼'] = payOffCount
                if (payOffCount == 0) {
                    break
                }
            }
        }
        console.log("after 5 ghost", allPairsForPayoff)
        var others = ["禍害", "六煞", "絕命"]
        others.map(function (target) {
            if (!allNamesCount[target]) {
                return
            }
            console.log("after 5 ghost qweqew", allPairsForPayoff)
            for (var i = 0; i < allPairsForPayoff.length; i++) {
                var sequence = allPairsForPayoff[i]
                var { newSequence, payOffCount } = payoffOthers(sequence, target, allNamesCount[target], allNamesCount)
                allPairsForPayoff[i] = newSequence
                allNamesCount[target] = payOffCount
                if (allNamesCount[target] == 0) {
                    break
                }
            }
        })
        console.log("allPairsForPayoff", allPairsForPayoff)
        console.log("allNamesCount", allNamesCount)

        // Show final result
        var resDom = document.getElementById("result-free")
        resDom.innerHTML = allNamesLine

        console.log(allNamesCount, allTotalNames)
        // Show paid off result
        var resDom = document.getElementById("result-free-stats")
        var totalCount = Object.keys(allNamesCount).reduce(function (acc, key) {
            return acc + allNamesCount[key];
        }, 0);
        if (totalCount === 0) {
            resDom.innerHTML = '<h3>小結</h3 >'
            resDom.innerHTML += "吉數凶數全部抵銷。"
            return
        }
        var { result, stats } = calOverallType(allNamesCount, totalCount)
        resDom.innerHTML = '<h3>小結</h3 >'
        resDom.innerHTML += stats
    }


    function ht5(number) {
        // heading & tailing 5
        for (var i = 0; i < number.length; i++) {
            if (number[i] != '5') {
                break
            }
            number[i] = '0'
        }
        // heading & tailing 5
        for (var i = number.length - 1; i >= 0; i--) {
            if (number[i] != '5') {
                break
            }
            number[i] = '0'
        }
        // middle 5
        for (var i = 0; i < number.length; i++) {
            var n0 = i > 0 ? number[i - 1] : false;
            var n1 = number[i];
            // find first non-5
            var n2 = '0'
            for (var j = i + 1; j < number.length; j++) {
                if (number[j] != '5') {
                    n2 = number[j]
                    break
                }
            }
            if (n1 === '5' && (n0 === '0' || n2 === '0')) {
                number[i] = '0'
            }
        }
        return number
    }

    function ht0(number) {
        // get first non-zero number
        var saved = false;
        for (var i = 0; i < number.length; i++) {
            if (number[i] != '0') {
                saved = number[i];
                break
            }
        }
        if (saved === false) {
            // All zero
            return number
        }
        // replace heading 0
        for (var i = 0; i < number.length; i++) {
            if (number[i] != '0') {
                break
            }
            number[i] = saved
        }
        // replace middle 0
        saved = false
        for (var i = 0; i < number.length; i++) {
            if (number[i] != '0') {
                saved = number[i];
            } else {
                number[i] = saved
            }
        }
        return number
    }

    function _calculate(number) {
        if (number.length < 2) {
            return []
        }

        if (typeof number === 'string') {
            number = number.split('')
        }
        number = ht5(number)
        // console.log(number)
        number = ht0(Array.from(number))

        // duplicate 5
        var nSeries = []
        for (var i = 0; i < number.length; i++) {
            var n0 = i > 0 ? number[i - 1] : false;
            var n1 = number[i];
            if (n1 == '5') {
                // calculate successive 5
                var tailNum = false;
                for (var j = i; j < number.length; j++) {
                    if (number[j] != '5') {
                        tailNum = number[j]
                        break
                    }
                }
                for (var k = 0; k < j - i + 1; k++) {
                    if (k > 0) { nSeries.push(n0) }

                    if (k != j - i) {
                        nSeries.push(tailNum)
                    }
                }
                // all 5 handled
                i = j - 1
                continue
            }
            nSeries.push(n1)
        }
        return nSeries
    }


    function _getPairs(number) {
        var resultPairs = [];
        for (var i = 0; i < number.length - 1; i++) {
            resultPairs.push(number[i] + number[i + 1])
        }
        return resultPairs
    }

    function calculate(number) {
        number = _calculate(number)
        return _getPairs(Array.from(number))
    }

    function createViewFromPairs(pairs) {
        numbersLine = pairs.map(function (pair) {
            return "<u>" + toFullWidth(pair) + "</u> ";
        }).join(" ")
        namesLine = pairs.map(function (pair) {
            return "<span>" + getNumberName(pair) + "</span> ";
        }).join(" ")
        table = "<table><thead><tr><th>階段</th><th>數字</th></tr></thead><tbody>";
        table += pairs.map(function (pair, i) {
            return "<tr><td>" + getStage(i, pairs.length) + "</td><td>" + getNumberName(pair) + "</td></tr>"
        }).join("")
        table += "</tbody></table>";

        var namesCount = {};
        var totalNames = 0;
        var prevNoneLay = '伏位';
        var realSeq = []

        for (var i = 0; i < pairs.length; i++) {
            var n = getNumberName(pairs[i])
            console.log(i, n, prevNoneLay)
            if (n == "伏位") {
                // Count the occurrence of each name
                if (namesCount[prevNoneLay]) {
                    namesCount[prevNoneLay]++;
                } else {
                    namesCount[prevNoneLay] = 1;
                }
                realSeq.push(prevNoneLay)
                totalNames++;
                continue
            }
            prevNoneLay = n

            // Count the occurrence of each name
            if (namesCount[n]) {
                namesCount[n]++;
            } else {
                namesCount[n] = 1;
            }
            realSeq.push(n)
            totalNames++;
        }
        var realNamesLine = realSeq.map(function (name, idx) {
            if (getNumberName(pairs[idx]) == "伏位" && name != "伏位") {
                return '<span class="gray">' + name + "</span> ";
            }
            return "<span>" + name + "</span> ";
        }).join(" ")
        namesLine = realNamesLine // test
        return {
            numbersLine: numbersLine,
            namesLine: namesLine,
            namesCount: namesCount,
            totalNames: totalNames,
            table: table,
            realSeq: realSeq
        }
    }


    function getStage(i, total) {
        var arr = [
            "0~10歲", // 0
            "11~15歲", // 1
            "16~20歲", // 2
            "21~25歲", // 3
            "26~30歲", // 4
            "31~35歲", // 5
            "36~40歲", // 6
            "41~45歲", // 7
            "46~50歲", // 8
            "51~70歲", // 9
            "71~90歲",
            "91~110歲",
            "111~130歲",
        ]
        var arr2 = [
            "51~60歲",
            "61~70歲",
            "71~80歲",
            "81~90歲",
            "91~100歲",
            "101~110歲",
            "111~120歲",
            "121~130歲",
        ]
        if (i > 8 && total > 10) {
            return arr2[i - 9]
        }
        if (i >= arr.length)
            return "ERROR"
        return arr[i]
    }

    function calOverallType(namesCount, totalNames) {
        // Create items array
        var sortedNames = Object.keys(namesCount).map(function (key) {
            if (namesCount[key] == 0) {
                return false
            }
            // key, count, percentage
            return [key, namesCount[key], namesCount[key] / totalNames];
        }).filter(function (v) { return v !== false });
        // Sort the array based on the second element
        sortedNames = sortedNames.sort(function (first, second) {
            return second[1] - first[1];
        });
        var result = "您為「<strong>" + sortedNames[0][0] + "</strong>」型的人<br>";
        var stats = sortedNames.map(function (v) {
            return v[0] + ": " + v[1] + " (" + (v[2] * 100).toFixed(1) + "%)";
        }).join(", ")
        return { result, stats }
    }

    function toFullWidth(str) {
        var fullWidth = "";
        for (var i = 0; i < str.length; i++) {
            var code = str.charCodeAt(i);
            if (code >= 48 && code <= 57) {
                fullWidth += String.fromCharCode(code + 65248);
            } else {
                fullWidth += str.charAt(i);
            }
        }
        return fullWidth;
    }

    function getNumberName(pair) {
        switch (pair) {
            case "17":
            case "71":
            case "89":
            case "98":
            case "46":
            case "64":
            case "23":
            case "32":
                return "禍害";
            case "16":
            case "61":
            case "47":
            case "74":
            case "38":
            case "83":
            case "92":
            case "29":
                return "六煞";
            case "18":
            case "81":
            case "79":
            case "97":
            case "42":
            case "24":
            case "36":
            case "63":
                return "五鬼";
            case "12":
            case "21":
            case "96":
            case "69":
            case "84":
            case "48":
            case "73":
            case "37":
                return "絕命";
            case "00":
            case "11":
            case "22":
            case "33":
            case "44":
            case "55":
            case "66":
            case "77":
            case "88":
            case "99":
                return "伏位";
            case "19":
            case "91":
            case "87":
            case "78":
            case "34":
            case "43":
            case "26":
            case "62":
                return "延年";
            case "13":
            case "31":
            case "68":
            case "86":
            case "49":
            case "94":
            case "72":
            case "27":
                return "天醫";
            case "14":
            case "41":
            case "76":
            case "67":
            case "93":
            case "39":
            case "82":
            case "28":
                return "生氣";
            default:
                return "ＸＸ";
        }
    }
</script>