<!DOCTYPE html>
<html>

<head>
    <title>東方靈數（好命密碼）計算器</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3Y8XCL2WW1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-3Y8XCL2WW1');
</script>
<style>
    p,
    input,
    button {
        font-size: 20px;
    }

    table,
    th,
    td {
        border: 1px solid black;

    }

    th,
    td {
        padding: 2px 20px;
    }
</style>

<body>
    <h1>東方靈數（好命密碼）計算器</h1>
    <p>計算所輸入數字的東方靈數<br>（生氣、天醫、延年、伏位、絕命、五鬼、六煞、禍害）</p>
    <p>數字意義解說請看：<a target="_blank"
            href="https://docs.google.com/spreadsheets/u/0/d/18McHGqDtBXo3KZub1rwe8vI3SGXFI7lctMWY9U6yl4c/htmlview">東方靈數
            分享版 </a></p>

    <h2>分析1：人格類型+流年</h2>
    <h3 for="numberInput">請輸入身分證字號：</h3>
    <input type="text" id="numberInput" onkeydown="if(event.keyCode == 13){calculateID()}" style="font-size: 20px;">
    <br>
    <input type="radio" id="no-trans" name="transform" value="no" /> 我自己處理 0 跟 5 [給有聽 podcast 的人 XD] <br>
    <input type="radio" id="trans" name="transform" value="yes" checked /> 幫我轉換 0 跟 5 [簡易轉法, 請見最下方說明]<br>
    <button onclick="calculateID()">計算</button>

    <p id="recap-input"></p>
    <p id="result-overall-type"></p>
    <p id="result-yearly-fortune"></p>
    <hr />
    <h2>分析2：任何其他數字（手機、車牌、住址等）</h2>
    <p>
        若遇到英文，會依照A=01, B=02, ... 的規則轉換
        <br />非英文或數字的符號會被跳過
    </p>
    <h3 for="numberInputAny">請輸入一串英數字：</h3>
    <label>地址也可，但數字請使用半型阿拉伯數字，例如 100台北市中正區重慶南路1段122號</label>
    <br>
    <input type="text" id="numberInputAny" onkeydown="if(event.keyCode == 13){calculateAny()}" style="font-size: 20px;">
    <br>
    <input type="radio" id="no-trans" name="transform-any" value="no" /> 我自己處理 0 跟 5 [給有聽 podcast 的人 XD]<br>
    <input type="radio" id="trans" name="transform-any" value="yes" checked /> 幫我轉換 0 跟 5 [簡易轉法, 請見最下方說明]<br>
    <button onclick="calculateAny()">計算</button>
    <p id="recap-input-2"></p>
    <p id="result-any"></p>
    <p id="result-any-stats"></p>
    <hr />
    <h2>數字化解口訣</h2>
    <p>
        天醫 欺 絕命<br>
        延年 壓 六煞<br>
        生氣 補 禍害<br>
        生氣+天醫+延命 化 五鬼 (順序不可變)<br>
    </p>
    <hr />
    <p>
        參考資料:
    <ul>
        <li><a target="_blank"
                href="https://docs.google.com/spreadsheets/u/0/d/18McHGqDtBXo3KZub1rwe8vI3SGXFI7lctMWY9U6yl4c/htmlview">
                東方靈數解釋 分享版 （ \感謝社群/ ） </a></li>
        <li><a target="_blank" href="https://www.chinyuan.com.tw/all_book/more?id=4878"> 好命密碼 - 數字磁場的魅力 </a></li>
        <li><a target="_blank" href="https://www.youtube.com/watch?v=7__exuY_6Bg"> 神仙補習班 - 東方靈數 </a></li>
        <li> <a target="_blank" href="https://www.instagram.com/p/C2RWknTP7ce/"> 神仙補習班 ig </a></li>
    </ul>
    </p>
    <hr />
    <p>
        作者說明區:
    <ul>
        <li>網站不會搜集資料，請安心餵各種數字。</li>
        <li>0 跟 5 的簡易轉換法是參考好命密碼的書（中間的5略過、頭尾5複製旁邊），程式比較好寫。</li>
        <li>簡易轉法範例 307 = 30,07 = 33,77，所以會一堆伏位唷</li>
        <li>補習班說的 05 處理法比較複雜，我自己也聽不太懂 囧，有興趣的大德麻煩先手轉...</li>
        <li>00 目前會顯示 XX，不知道是伏位還是沒有對應數字，待挖掘</li>
        <li>參考資料區如果任何原因不想被放上來，請寄信給我，我會立刻撤下：<a href="mailto:sepag27368@wentcity.com">sepag27368@wentcity.com</a></li>
        <li>發現程式錯誤也歡迎用同個信箱回報，\全民 debug/：<a href="mailto:sepag27368@wentcity.com">sepag27368@wentcity.com</a></li>
    </ul>

    </p>
    <script>
        function convertToAlphabeticalOrder(letter) {
            var lowercaseLetter = letter.toLowerCase();
            var alphabeticalOrder = lowercaseLetter.charCodeAt(0) - 96;
            if (alphabeticalOrder > 26 || alphabeticalOrder < 1) {
                return null;
            }
            return alphabeticalOrder.toString().padStart(2, '0');
        }

        function skipNonHalfWidthNumbers(value) {
            var newValue = "";
            for (var i = 0; i < value.length; i++) {
                var code = value.charCodeAt(i);
                if (code >= 48 && code <= 57) {
                    newValue += value.charAt(i);
                } else {
                    var tmp = convertToAlphabeticalOrder(value.charAt(i))
                    if (tmp != null) {
                        newValue += tmp;
                    }
                }
            }
            return newValue
        }


        function parse05(value) {
            var v = value.split("");
            var newValue = "";
            for (var i = 0; i < v.length; i++) {
                if (v[i] == '5' && i > 0 && i < v.length - 1) {
                    // skip middle 5
                    continue
                }
                newValue += v[i];
            }
            return newValue;
        }

        function parsePair(value) {
            if (value == '00') {
                return value
            }

            var v = value.split("");
            if (v[0] == '5' || v[1] == '5') {
                return '55'; // 伏位
            }
            if (v[0] == '0' || v[1] == '0') {
                return '55'; // 伏位
            }
            return value
        }

        function showResult() {
            // Collect results
            // result 1: your overall type
            // result 2: your year fortune
        }

        function getIDInput() {
            var shouldTrans = document.querySelector('input[name="transform"]:checked').value == 'yes'
            if (shouldTrans) {
                return parse05(skipNonHalfWidthNumbers(document.getElementById("numberInput").value));
            }
            return skipNonHalfWidthNumbers(document.getElementById("numberInput").value);
        }
        function getAnyInput() {
            var shouldTrans = document.querySelector('input[name="transform-any"]:checked').value == 'yes'
            if (shouldTrans) {
                return parse05(skipNonHalfWidthNumbers(document.getElementById("numberInputAny").value));
            }
            return skipNonHalfWidthNumbers(document.getElementById("numberInputAny").value);
        }

        function calculateID() {
            var number = getIDInput()


            var namesCount = {};

            // show overall type
            var overallNum = number
            if (number.slice(0, 1) == '0') {
                overallNum = number.slice(1)
            }
            console.log("overallNum", overallNum)

            // var resDom = document.getElementById("recap-input")
            // resDom.innerHTML = ''
            // resDom.innerHTML += inputNumber

            var resDom = document.getElementById("result-overall-type")
            var { numbersLine, namesLine, namesCount, totalNames, table } = calPairs(overallNum);
            resDom.innerHTML = '<h4>類型：</h4>'
            resDom.innerHTML += "使用：<u>" + overallNum + "</u> (此項不看開頭0) <br> ";
            var { result, stats } = calOverallType(namesCount, totalNames)
            resDom.innerHTML += numbersLine + '<br>' + namesLine + "<br>"
            resDom.innerHTML += stats + "<br><br>" + result

            // show yearly fortune
            var resDom = document.getElementById("result-yearly-fortune")
            var { numbersLine, namesLine, namesCount, totalNames } = calPairs(number);
            resDom.innerHTML = '<h4>流年：</h4>'
            resDom.innerHTML += "流年使用：<u>" + number + "</u><br>";
            resDom.innerHTML += numbersLine + '<br>' + namesLine + "<br>"
            resDom.innerHTML += table;
        }
        function calculateAny() {
            var number = getAnyInput()
            var inputNumber = "您輸入的數字為：<u>" + number + "</u>";

            var namesCount = {};

            // show overall type
            var overallNum = number
            if (number.slice(0, 1) == '0') {
                overallNum = number.slice(1)
            }
            console.log(overallNum)

            var resDom = document.getElementById("recap-input-2")
            resDom.innerHTML = ''
            resDom.innerHTML += inputNumber

            var resDom = document.getElementById("result-any")
            var { numbersLine, namesLine, namesCount, totalNames, table } = calPairs(number);
            resDom.innerHTML = numbersLine + '<br>' + namesLine + "<br>"

            var resDom = document.getElementById("result-any-stats")
            var { result, stats } = calOverallType(namesCount, totalNames)
            resDom.innerHTML = stats

            // show yearly fortune
            // var resDom = document.getElementById("result-yearly-fortune")
            // var { numbersLine, namesLine, namesCount, totalNames } = calPairs(number);
            // resDom.innerHTML = ''
            // resDom.innerHTML += table;
        }

        function calPairs(number) {
            var numbersLine = "";
            var namesLine = "";

            var namesCount = {};
            var totalNames = 0;

            var table = "<table><thead><tr><th>階段</th><th>數字</th></tr></thead><tbody>";

            for (var i = 0; i < number.length - 1; i++) {
                var pair = number.slice(i, i + 2);
                numbersLine += "<u>" + toFullWidth(pair) + "</u> ";
                pair = parsePair(pair);
                var n = getNumberName(pair)
                namesLine += n + " ";

                table += "<tr><td>" + getStage(i) + "</td><td>" + n + "</td></tr>"

                if (n == "ＸＸ") {
                    continue;
                }

                // Count the occurrence of each name
                if (namesCount[n]) {
                    namesCount[n]++;
                } else {
                    namesCount[n] = 1;
                }
                totalNames++;
            }
            table += "</tbody></table>";
            return {
                numbersLine: numbersLine,
                namesLine: namesLine,
                namesCount: namesCount,
                totalNames: totalNames,
                table: table
            }
        }
        function getStage(i) {
            var arr = [
                "0~10歲",
                "11~15歲",
                "16~20歲",
                "21~25歲",
                "26~30歲",
                "31~35歲",
                "36~40歲",
                "41~45歲",
                "46~50歲",
                "51~70歲"
            ]
            if (i >= arr.length)
                return "ERROR"
            return arr[i]
        }

        function calOverallType(namesCount, totalNames) {
            // Create items array
            var sortedNames = Object.keys(namesCount).map(function (key) {
                // key, count, percentage
                return [key, namesCount[key], namesCount[key] / totalNames];
            });
            // Sort the array based on the second element
            sortedNames = sortedNames.sort(function (first, second) {
                return second[1] - first[1];
            });
            var result = "您為「<strong>" + sortedNames[0][0] + "</strong>」型的人<br>";
            var stats = sortedNames.map(function (v) {
                return v[0] + ": " + v[1] + " (" + (v[2] * 100).toFixed(1) + "%)";
            }).join(", ")
            return { result, stats }
        }

        function toFullWidth(str) {
            var fullWidth = "";
            for (var i = 0; i < str.length; i++) {
                var code = str.charCodeAt(i);
                if (code >= 48 && code <= 57) {
                    fullWidth += String.fromCharCode(code + 65248);
                } else {
                    fullWidth += str.charAt(i);
                }
            }
            return fullWidth;
        }

        function getNumberName(pair) {
            switch (pair) {
                case "17":
                case "71":
                case "89":
                case "98":
                case "46":
                case "64":
                case "23":
                case "32":
                    return "禍害";
                case "16":
                case "61":
                case "47":
                case "74":
                case "38":
                case "83":
                case "92":
                case "29":
                    return "六煞";
                case "18":
                case "81":
                case "79":
                case "97":
                case "42":
                case "24":
                case "36":
                case "63":
                    return "五鬼";
                case "12":
                case "21":
                case "96":
                case "69":
                case "84":
                case "48":
                case "73":
                case "37":
                    return "絕命";
                case "11":
                case "22":
                case "33":
                case "44":
                case "55":
                case "66":
                case "77":
                case "88":
                case "99":
                    return "伏位";
                case "19":
                case "91":
                case "87":
                case "78":
                case "34":
                case "43":
                case "26":
                case "62":
                    return "延年";
                case "13":
                case "31":
                case "68":
                case "86":
                case "49":
                case "94":
                case "72":
                case "27":
                    return "天醫";
                case "14":
                case "41":
                case "76":
                case "67":
                case "93":
                case "39":
                case "82":
                case "28":
                    return "生氣";
                default:
                    return "ＸＸ";
            }
        }
    </script>
</body>

</html>